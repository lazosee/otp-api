<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>OTP API</title>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"
			integrity="sha512-TscjjxDy2iXx5s55Ar78c01JDHUug0K5aw4YKId9Yuocjx3ueX/X9PFyH5XNRVWqagx3TtcQWQVBaHAIPFjiFA=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
	</head>
	<body class="w-full min-h-screen p-2 block content-center-safe justify-items-center-safe">
		<h1 class="text-zinc-800 text-3xl font-semibold">Welcome to the OTP API</h1>
		<section class="block min-w-9/10 max-w-[max(100%, 80ch)] m-2 p-2">
			<hr class="w-full my-4 border-zinc-200" />
			<h2 class="text-zinc-800 text-2xl font-light">API Playground</h2>

			<div class="my-2 block p-2 border border-zinc-200 rounded-md bg-zinc-50 shadow-sm">
				<p
					class="block py-2 underline decoration-wavy decoration-zinc-300 underline-offset-2 text-xl font-normal text-zinc-800"
				>
					1. Generate OTP
				</p>
				<div class="flex w-full py-2">
					<span class="p-1 px-2 text-lg font-normal text-zinc-800 bg-slate-200 rounded-md mr-2"
						>method: POST</span
					>
					<span class="p-1 px-2 text-lg font-normal text-zinc-800 bg-slate-200 rounded-md mr-2"
						>route: <span class="route"></span>/api/generate-otp</span
					>
					<button
						type="button"
						id="generateOtpButton"
						onclick="fetchOtp"
						class="flex gap-2 items-center justify-center p-1 px-2 text-lg capitalize font-normal text-zinc-800 bg-blue-400 rounded-md mr-2"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							height="24px"
							viewBox="0 -960 960 960"
							width="24px"
							class="fill-current"
						>
							<path
								d="m380-300 280-180-280-180v360ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"
							/>
						</svg>
						run
					</button>
				</div>
				<div class="w-full block">
					<label for="generateOtpEmail" class="block text-zinc-700 font-medium mb-1">Email: </label>
					<input
						type="email"
						id="generateOtpEmail"
						class="block w-full p-2 bg-zinc-100 rounded-md text-zinc-800 border border-zinc-200"
						placeholder="User email address"
						value="tester@email.com"
					/>
				</div>
				<div class="w-full block">
					<label for="generateOtpTtl" class="block text-zinc-700 font-medium mb-1"
						>TTL (seconds):
					</label>
					<input
						type="number"
						id="generateOtpTtl"
						class="block w-full p-2 bg-zinc-100 rounded-md text-zinc-800 border border-zinc-200"
						placeholder="300"
						value="300"
					/>
				</div>
				<div class="w-full block">
					<label for="generateOtpResult" class="block text-zinc-700 font-medium mb-1"
						>Response:
					</label>
					<textarea
						name=""
						id="generateOtpResult"
						class="block w-full p-2 bg-zinc-100 rounded-md text-zinc-800 font-mono border border-zinc-200 min-h-[200px] resize-y"
					></textarea>
				</div>
			</div>

			<div class="my-2 block p-2 border border-zinc-200 rounded-md bg-zinc-50 shadow-sm">
				<p
					class="block py-2 underline decoration-wavy decoration-zinc-300 underline-offset-2 text-xl font-normal text-zinc-800"
				>
					2. Verify OTP
				</p>
				<div class="flex w-full py-2">
					<span class="p-1 px-2 text-lg font-normal text-zinc-800 bg-slate-200 rounded-md mr-2"
						>method: POST</span
					>
					<span class="p-1 px-2 text-lg font-normal text-zinc-800 bg-slate-200 rounded-md mr-2"
						>route: <span class="route"></span>/api/verify-otp</span
					>
					<button
						type="button"
						id="verifyOtpButton"
						onclick="verifyOtp"
						class="flex gap-2 items-center justify-center p-1 px-2 text-lg capitalize font-normal text-zinc-800 bg-blue-400 rounded-md mr-2"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							height="24px"
							viewBox="0 -960 960 960"
							width="24px"
							class="fill-current"
						>
							<path
								d="m380-300 280-180-280-180v360ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"
							/>
						</svg>
						run
					</button>
				</div>
				<div class="w-full block">
					<label for="generateOtpEmail" class="block text-zinc-700 font-medium mb-1">Email: </label>
					<input
						type="email"
						id="generateOtpEmail"
						class="block w-full p-2 bg-zinc-100 rounded-md text-zinc-800 border border-zinc-200"
						placeholder="User email address"
						value="tester@email.com"
					/>
				</div>
				<div class="w-full block">
					<label for="verifyOtpCode" class="block text-zinc-700 font-medium mb-1">OTP Code: </label>
					<input
						type="number"
						id="verifyOtpCode"
						class="block w-full p-2 bg-zinc-100 rounded-md text-zinc-800 border border-zinc-200"
						placeholder="123456"
						value=""
					/>
				</div>
				<div class="w-full block">
					<label for="verifyOtpResult" class="block text-zinc-700 font-medium mb-1"
						>Response:
					</label>
					<textarea
						name=""
						id="verifyOtpResult"
						class="block w-full p-2 bg-zinc-100 rounded-md text-zinc-800 font-mono border border-zinc-200 min-h-[200px] resize-y"
					></textarea>
				</div>
			</div>
		</section>
		<script>
			const routeSpans = document.querySelectorAll('.route')
			routeSpans.forEach((span) => {
				span.innerText = window.location.origin
				console.log(span)
			})

			generateOtpButton.onclick = async function fetchOtp() {
				generateOtpResult.innerText = 'Loading...'

				const email = document.getElementById('generateOtpEmail').value
				const ttl = parseInt(document.getElementById('generateOtpTtl').value) || 300

				console.log({ email, ttl })

				const response = await fetch('/api/generate-otp', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ email, ttl }),
				})
				const data = await response.json()
				document.getElementById('generateOtpResult').innerText = JSON.stringify(data, null, 2)
			}

			verifyOtpButton.onclick = async function verifyOtp() {
				verifyOtpResult.innerText = 'Loading...'

				const email = document.getElementById('generateOtpEmail').value
				const code = document.getElementById('verifyOtpCode').value.toString().trim()

				console.log({ email, code })

				const response = await fetch('/api/verify-otp', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ email, code }),
				})
				const data = await response.json()
				document.getElementById('verifyOtpResult').innerText = JSON.stringify(data, null, 2)
			}
		</script>
	</body>
</html>
